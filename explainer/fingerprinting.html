<!DOCTYPE html>

<html>
<head>
    <title>Fingerprinting Playground</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <link href="https://fonts.googleapis.com/css2?family=Jura:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel="stylesheet">


    <style>
        /*BoilerPlate CSS*/
        html, body {padding: 0;margin: 0;-webkit-font-smoothing: antialiased;-moz-osx-font-smoothing: grayscale;height:100%;}
        h1, h2, h3, h4, h5, h6 {font-weight: 400;margin: 0;padding: 0;}
        ::placeholder {color: rgba(20,0,0,1);opacity:1;}
        *:focus {outline: none;}

        /* Enter New CSS*/
        body {color:white;font-family:Jura;background:#082973}
        table {border-collapse: collapse;border:1px solid rgba(255,255,255,0.25);table-layout: fixed;width:100%;}
        th, td {padding:.5em 1em;text-align: left;vertical-align: top;word-break: break-word;}
        th {background:#c12;color:white;text-transform:uppercase;font-weight:600}
        td:first-child {background:rgba(0,0,0,0.15);text-transform:uppercase;font-weight:600}
        td:nth-child(2) {font-family:Source Code Pro;color:#f0e21e;}
        tr {border-bottom:1px solid rgba(255,255,255,0.25);}
        code {color:#f0e21e}

        a {color:gray;}

        #drawing {display:none;background:white;}

        #backAgain {
          margin-top: 1em;
          color: #f0e21e;
          font-weight: 600;
          text-transform: uppercase;
          display: inline-block;
          background: rgba(0,0,0,0.25);
          padding: 1em;
        }
        </style>
    </head>

    <body>
      <div style="background:rgba(0,0,0,0.15);height:100vh;max-width:1280px;padding:2em;margin:0 auto;">
        <h1 style="text-transform:uppercase;margin-bottom:1em;font-weight:600;">Fingerprinting</h1>
      <canvas id="drawing"></canvas>

      <table>
        <tr>
          <th width="10%">Data Point</th>
          <th width="30%">Value</th>
          <th width="15%">Concept</th>
          <th width="15%">How Is It Generated?</th>
          <th width="15%">Intended Usage</th>
          <th width="15%">Defenses</th>
        </tr>
        <tr>
          <td>Canvas Fingerprint</td>
          <td id="canvasHash"></td>
          <td>Images generated by the same code will vary slightly from computer to computer based on things like the graphics card, OS, and browser. The image can be exported and hashed. <a href="https://www.ieee-security.org/TC/W2SP/2012/papers/w2sp12-final4.pdf">Research Paper</a></td>
          <td>A hidden image was generated using the most common font (Arial) and a few graphical effects. It was then exported and hashed using MD5. <a href="#" onClick="showCanvas()">Show Image</a></td>
          <td>Graphic Apps: <a href="https://awwapp.com/">https://awwapp.com/</a> <a href="https://www.photopea.com/">https://www.photopea.com/</a></td>
          <td>Disable JavaScript</td>
        </tr>
        <tr>
          <td>IP Address</td>
          <td id="ipContainer"></td>
          <td>Your IP address uniquely identifies your computer so that web servers know where to send web content to.</td>
          <td>A "fetch" request was sent to Cloudfare (https://www.cloudflare.com/cdn-cgi/trace). The result was sent back to this webpage and the IP address that was returned was extracted and displayed. <p>Also: https://code-examples.net/en/q/5fb2b and https://stackoverflow.com/questions/391979/how-to-get-clients-ip-address-using-javascript</p></td>
          <td>Necessary for computers to know where to send data.</a></td>
          <td><p>VPN</p> <p>TOR</p> <p>Proxy Sites (<a href="https://www.proxysite.com/">www.proxysite.com</a>)</p></td>
        </tr>
        <tr>
          <td>Operating System</td>
          <td id="osContainer"></td>
          <td></td>
          <td>Built-in JavaScript Method. In a browser Javascript console, you just need to type <code>navigator.oscpu</code> to see the string.</td>
          <td>Serving correct downloads. Ex: <a href="https://www.videolan.org/vlc/">VLC</a></a></td>
          <td>Disable JavaScript</td>
        </tr>
        <tr>
          <td>Browser</td>
          <td id="browserContainer"></td>
          <td></td>
          <td>Built-in JavaScript method. In the console, type <code>navigator.useragent</code> to see the string.</td>
          <td>Troubleshooting & Feature Detection (does browser support x technology)</td>
          <td>Disable JavaScript</td>
        </tr>
        <tr>
          <td>Time-Zone</td>
          <td id="tzContainer"></td>
          <td></td>
          <td>Built-in. In console, just type <code>Intl.DateTimeFormat().resolvedOptions().timeZone</code> to see the string.</td>
          <td>Dynamic Dark Mode</td>
          <td>Disable JavaScript</td>
        </tr>
        <tr>
          <td>Loaded Cookies</td>
          <td id="cookieContainerBypass"></td>
          <td><button onclick="alert(document.cookie)">Show Cookies</button>Cookies are semicolon-separated pieces of data that are sent to the server every time a request is made. The data can be used to authenticate you so that you don't have to log in to each page you visit. But these cookies can also be used to track the sites you visit</td>
          <td>JavaScript was used to place a cookie tying your canvas fingerprint to a data point named "id"</td>
          <td>Ability for website to recognize you as legitimate owner of an account.</td>
          <td>Browser settings and clearing cookies</td>
        </tr>
      </table>

      <h2 id="backAgain"></h2>

    </body>



<script>

  // MD5 Checksum. Courtesy of https://css-tricks.com/snippets/javascript/javascript-md5/
  const MD5 = function (string) {

     function RotateLeft(lValue, iShiftBits) {
             return (lValue<<iShiftBits) | (lValue>>>(32-iShiftBits));
     }

     function AddUnsigned(lX,lY) {
             var lX4,lY4,lX8,lY8,lResult;
             lX8 = (lX & 0x80000000);
             lY8 = (lY & 0x80000000);
             lX4 = (lX & 0x40000000);
             lY4 = (lY & 0x40000000);
             lResult = (lX & 0x3FFFFFFF)+(lY & 0x3FFFFFFF);
             if (lX4 & lY4) {
                     return (lResult ^ 0x80000000 ^ lX8 ^ lY8);
             }
             if (lX4 | lY4) {
                     if (lResult & 0x40000000) {
                             return (lResult ^ 0xC0000000 ^ lX8 ^ lY8);
                     } else {
                             return (lResult ^ 0x40000000 ^ lX8 ^ lY8);
                     }
             } else {
                     return (lResult ^ lX8 ^ lY8);
             }
     }

     function F(x,y,z) { return (x & y) | ((~x) & z); }
     function G(x,y,z) { return (x & z) | (y & (~z)); }
     function H(x,y,z) { return (x ^ y ^ z); }
     function I(x,y,z) { return (y ^ (x | (~z))); }

     function FF(a,b,c,d,x,s,ac) {
             a = AddUnsigned(a, AddUnsigned(AddUnsigned(F(b, c, d), x), ac));
             return AddUnsigned(RotateLeft(a, s), b);
     };

     function GG(a,b,c,d,x,s,ac) {
             a = AddUnsigned(a, AddUnsigned(AddUnsigned(G(b, c, d), x), ac));
             return AddUnsigned(RotateLeft(a, s), b);
     };

     function HH(a,b,c,d,x,s,ac) {
             a = AddUnsigned(a, AddUnsigned(AddUnsigned(H(b, c, d), x), ac));
             return AddUnsigned(RotateLeft(a, s), b);
     };

     function II(a,b,c,d,x,s,ac) {
             a = AddUnsigned(a, AddUnsigned(AddUnsigned(I(b, c, d), x), ac));
             return AddUnsigned(RotateLeft(a, s), b);
     };

     function ConvertToWordArray(string) {
             var lWordCount;
             var lMessageLength = string.length;
             var lNumberOfWords_temp1=lMessageLength + 8;
             var lNumberOfWords_temp2=(lNumberOfWords_temp1-(lNumberOfWords_temp1 % 64))/64;
             var lNumberOfWords = (lNumberOfWords_temp2+1)*16;
             var lWordArray=Array(lNumberOfWords-1);
             var lBytePosition = 0;
             var lByteCount = 0;
             while ( lByteCount < lMessageLength ) {
                     lWordCount = (lByteCount-(lByteCount % 4))/4;
                     lBytePosition = (lByteCount % 4)*8;
                     lWordArray[lWordCount] = (lWordArray[lWordCount] | (string.charCodeAt(lByteCount)<<lBytePosition));
                     lByteCount++;
             }
             lWordCount = (lByteCount-(lByteCount % 4))/4;
             lBytePosition = (lByteCount % 4)*8;
             lWordArray[lWordCount] = lWordArray[lWordCount] | (0x80<<lBytePosition);
             lWordArray[lNumberOfWords-2] = lMessageLength<<3;
             lWordArray[lNumberOfWords-1] = lMessageLength>>>29;
             return lWordArray;
     };

     function WordToHex(lValue) {
             var WordToHexValue="",WordToHexValue_temp="",lByte,lCount;
             for (lCount = 0;lCount<=3;lCount++) {
                     lByte = (lValue>>>(lCount*8)) & 255;
                     WordToHexValue_temp = "0" + lByte.toString(16);
                     WordToHexValue = WordToHexValue + WordToHexValue_temp.substr(WordToHexValue_temp.length-2,2);
             }
             return WordToHexValue;
     };

     function Utf8Encode(string) {
             string = string.replace(/\r\n/g,"\n");
             var utftext = "";

             for (var n = 0; n < string.length; n++) {

                     var c = string.charCodeAt(n);

                     if (c < 128) {
                             utftext += String.fromCharCode(c);
                     }
                     else if((c > 127) && (c < 2048)) {
                             utftext += String.fromCharCode((c >> 6) | 192);
                             utftext += String.fromCharCode((c & 63) | 128);
                     }
                     else {
                             utftext += String.fromCharCode((c >> 12) | 224);
                             utftext += String.fromCharCode(((c >> 6) & 63) | 128);
                             utftext += String.fromCharCode((c & 63) | 128);
                     }

             }

             return utftext;
     };

     var x=Array();
     var k,AA,BB,CC,DD,a,b,c,d;
     var S11=7, S12=12, S13=17, S14=22;
     var S21=5, S22=9 , S23=14, S24=20;
     var S31=4, S32=11, S33=16, S34=23;
     var S41=6, S42=10, S43=15, S44=21;

     string = Utf8Encode(string);

     x = ConvertToWordArray(string);

     a = 0x67452301; b = 0xEFCDAB89; c = 0x98BADCFE; d = 0x10325476;

     for (k=0;k<x.length;k+=16) {
             AA=a; BB=b; CC=c; DD=d;
             a=FF(a,b,c,d,x[k+0], S11,0xD76AA478);
             d=FF(d,a,b,c,x[k+1], S12,0xE8C7B756);
             c=FF(c,d,a,b,x[k+2], S13,0x242070DB);
             b=FF(b,c,d,a,x[k+3], S14,0xC1BDCEEE);
             a=FF(a,b,c,d,x[k+4], S11,0xF57C0FAF);
             d=FF(d,a,b,c,x[k+5], S12,0x4787C62A);
             c=FF(c,d,a,b,x[k+6], S13,0xA8304613);
             b=FF(b,c,d,a,x[k+7], S14,0xFD469501);
             a=FF(a,b,c,d,x[k+8], S11,0x698098D8);
             d=FF(d,a,b,c,x[k+9], S12,0x8B44F7AF);
             c=FF(c,d,a,b,x[k+10],S13,0xFFFF5BB1);
             b=FF(b,c,d,a,x[k+11],S14,0x895CD7BE);
             a=FF(a,b,c,d,x[k+12],S11,0x6B901122);
             d=FF(d,a,b,c,x[k+13],S12,0xFD987193);
             c=FF(c,d,a,b,x[k+14],S13,0xA679438E);
             b=FF(b,c,d,a,x[k+15],S14,0x49B40821);
             a=GG(a,b,c,d,x[k+1], S21,0xF61E2562);
             d=GG(d,a,b,c,x[k+6], S22,0xC040B340);
             c=GG(c,d,a,b,x[k+11],S23,0x265E5A51);
             b=GG(b,c,d,a,x[k+0], S24,0xE9B6C7AA);
             a=GG(a,b,c,d,x[k+5], S21,0xD62F105D);
             d=GG(d,a,b,c,x[k+10],S22,0x2441453);
             c=GG(c,d,a,b,x[k+15],S23,0xD8A1E681);
             b=GG(b,c,d,a,x[k+4], S24,0xE7D3FBC8);
             a=GG(a,b,c,d,x[k+9], S21,0x21E1CDE6);
             d=GG(d,a,b,c,x[k+14],S22,0xC33707D6);
             c=GG(c,d,a,b,x[k+3], S23,0xF4D50D87);
             b=GG(b,c,d,a,x[k+8], S24,0x455A14ED);
             a=GG(a,b,c,d,x[k+13],S21,0xA9E3E905);
             d=GG(d,a,b,c,x[k+2], S22,0xFCEFA3F8);
             c=GG(c,d,a,b,x[k+7], S23,0x676F02D9);
             b=GG(b,c,d,a,x[k+12],S24,0x8D2A4C8A);
             a=HH(a,b,c,d,x[k+5], S31,0xFFFA3942);
             d=HH(d,a,b,c,x[k+8], S32,0x8771F681);
             c=HH(c,d,a,b,x[k+11],S33,0x6D9D6122);
             b=HH(b,c,d,a,x[k+14],S34,0xFDE5380C);
             a=HH(a,b,c,d,x[k+1], S31,0xA4BEEA44);
             d=HH(d,a,b,c,x[k+4], S32,0x4BDECFA9);
             c=HH(c,d,a,b,x[k+7], S33,0xF6BB4B60);
             b=HH(b,c,d,a,x[k+10],S34,0xBEBFBC70);
             a=HH(a,b,c,d,x[k+13],S31,0x289B7EC6);
             d=HH(d,a,b,c,x[k+0], S32,0xEAA127FA);
             c=HH(c,d,a,b,x[k+3], S33,0xD4EF3085);
             b=HH(b,c,d,a,x[k+6], S34,0x4881D05);
             a=HH(a,b,c,d,x[k+9], S31,0xD9D4D039);
             d=HH(d,a,b,c,x[k+12],S32,0xE6DB99E5);
             c=HH(c,d,a,b,x[k+15],S33,0x1FA27CF8);
             b=HH(b,c,d,a,x[k+2], S34,0xC4AC5665);
             a=II(a,b,c,d,x[k+0], S41,0xF4292244);
             d=II(d,a,b,c,x[k+7], S42,0x432AFF97);
             c=II(c,d,a,b,x[k+14],S43,0xAB9423A7);
             b=II(b,c,d,a,x[k+5], S44,0xFC93A039);
             a=II(a,b,c,d,x[k+12],S41,0x655B59C3);
             d=II(d,a,b,c,x[k+3], S42,0x8F0CCC92);
             c=II(c,d,a,b,x[k+10],S43,0xFFEFF47D);
             b=II(b,c,d,a,x[k+1], S44,0x85845DD1);
             a=II(a,b,c,d,x[k+8], S41,0x6FA87E4F);
             d=II(d,a,b,c,x[k+15],S42,0xFE2CE6E0);
             c=II(c,d,a,b,x[k+6], S43,0xA3014314);
             b=II(b,c,d,a,x[k+13],S44,0x4E0811A1);
             a=II(a,b,c,d,x[k+4], S41,0xF7537E82);
             d=II(d,a,b,c,x[k+11],S42,0xBD3AF235);
             c=II(c,d,a,b,x[k+2], S43,0x2AD7D2BB);
             b=II(b,c,d,a,x[k+9], S44,0xEB86D391);
             a=AddUnsigned(a,AA);
             b=AddUnsigned(b,BB);
             c=AddUnsigned(c,CC);
             d=AddUnsigned(d,DD);
     		}

     	var temp = WordToHex(a)+WordToHex(b)+WordToHex(c)+WordToHex(d);

     	return temp.toLowerCase();
  }

    // Canvas FingerPrint
    const canvas = document.getElementById("drawing");
    const context = canvas.getContext("2d");
    const txt = "The quick brown fox jumps over the lazy dog";
    context.textBaseline = "top";
    // The most common type
    context.font = "14px 'Arial'";
    context.textBaseline = "alphabetic";
    context.fillStyle = "#f60";
    context.fillRect(125,1,62,20);
    // Some tricks for color mixing to increase the difference in rendering
    context.fillStyle = "#069";
    context.fillText(txt, 2, 15);
    context.fillStyle = "rgba(102, 204, 0, 0.7)";
    context.fillText(txt, 4, 17);
    canvasImage = canvas.toDataURL();
    //console.log (canvasImage)
    console.log("Canvas Fingerprint Hash: " + MD5(canvasImage))
    const canvasContainer = document.getElementById("canvasHash")
    let theHash = MD5(canvasImage)
    canvasContainer.innerText = theHash

    //Get IP Address from Cloudflare
    let theIP = ""
    fetch('https://www.cloudflare.com/cdn-cgi/trace')
      .then(
        function(response) {
          if (response.status !== 200) {
            console.log('Looks like there was a problem. Status Code: ' +
              response.status);
            return;
          }

          // Examine the text in the response
          response.text().then(function(text) {

    	if( text != '' )
                {
                    const txt = text.split("\n");
    		const sanitizedIP = txt[2].replace("ip=","")
        const please = document.getElementById("ipContainer")
                    please.innerText = sanitizedIP;
                    theIP = sanitizedIP;
    		console.log(sanitizedIP);
                } else {}
            });
        }
      )
      .catch(function(err) {
        console.log('Fetch Error :-S', err);
      });

      // Show OS
      const osValue = navigator.oscpu;
      const osVersion = document.getElementById("osContainer")
      osVersion.innerText = osValue;

      // View Browser version
      function get_browser_info(){
        var ua=navigator.userAgent,tem,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];
        if(/trident/i.test(M[1])){
            tem=/\brv[ :]+(\d+)/g.exec(ua) || [];
            return {name:'IE ',version:(tem[1]||'')};
            }
        if(M[1]==='Chrome'){
            tem=ua.match(/\bOPR\/(\d+)/)
            if(tem!=null)   {return {name:'Opera', version:tem[1]};}
            }
        M=M[2]? [M[1], M[2]]: [navigator.appName, navigator.appVersion, '-?'];
        if((tem=ua.match(/version\/(\d+)/i))!=null) {M.splice(1,1,tem[1]);}
        return {
          name: M[0],
          version: M[1]
        };
      }

      const browserBox = document.getElementById("browserContainer")
      const browser=get_browser_info();
      browserBox.innerText = browser.name + " " + browser.version

      // localStorage testing
      appData = window.localStorage

      savedHash = appData.getItem("hash")
      savedIP = appData.getItem("ip")
      const returnMessage = document.getElementById("backAgain")
      if(savedHash == theHash && savedIP == theIP) {
        console.log("Welcome back, bruh")
        returnMessage.innerText="Welcome Back, Bruh!"
      } else {
        console.log("First Time, huh")
        appData.setItem("hash", theHash)
        appData.setItem("ip", theIP)
      }
      console.log(appData)
      // Store visited URLs in Localstorage and SHow previously visited pages

      // Cookies
      function createCookie(name,value,days) {
      	if (days) {
      		var date = new Date();
      		date.setTime(date.getTime()+(days*24*60*60*1000));
      		var expires = "; expires="+date.toGMTString();
      	}
      	else var expires = "";
      	document.cookie = name+"="+value+expires+"; SameSite=Lax; path=/";
      }

      function readCookie(name) {
      	var nameEQ = name + "=";
      	var ca = document.cookie.split(';');
      	for(var i=0;i < ca.length;i++) {
      		var c = ca[i];
      		while (c.charAt(0)==' ') c = c.substring(1,c.length);
      		if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
      	}
      	return null;
      }

      function eraseCookie(name) {
      	createCookie(name,"",-1);
      }

      createCookie("userId", theHash, 7);

      const cookieList = document.cookie
      const cookieBox=document.getElementById("cookieContainerBypass") //Ublock Origin displays none if ID = cookieContainer
      cookieBox.innerText = cookieList;


      // Get Timezone
      const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone
      const timeBox = document.getElementById("tzContainer")
      timeBox.innerText = timezone;

      function showCanvas() {
        const theCanvas = document.getElementById("drawing")
        theCanvas.style.display = "block"
      }

</script>
